$(function(){function e(){$("form.login p.error, form.register p.error").remove(),$("form.login input, form.register input").removeClass("error")}var r=!0;$(".switch-button").on("click",function(o){o.preventDefault(),$("input").val(""),e(),r?(r=!1,$(".register").show("slow"),$(".login").hide()):(r=!0,$(".login").show("slow"),$(".register").hide())}),$("form.login input, form.register input").on("focus",function(){e()}),$(".register-button").on("click",function(o){o.preventDefault(),e();o={login:$("#register-login").val(),password:$("#register-password").val(),passwordConfirm:$("#register-password-confirm").val()};$.ajax({type:"POST",data:JSON.stringify(o),contentType:"application/json",url:"/api/auth/register"}).done(function(o){o.ok?$(".register h2").after('<p class="success">Отлично!</p>'):($(".register h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("input[name="+o+"]").addClass("error")}))})}),$(".login-button").on("click",function(o){o.preventDefault(),e();o={login:$("#login-login").val(),password:$("#login-password").val()};$.ajax({type:"POST",data:JSON.stringify(o),contentType:"application/json",url:"/api/auth/login"}).done(function(o){o.ok?$(location).attr("href","/"):($(".login h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("input[name="+o+"]").addClass("error")}))})})}),$(function(){var r,n;function t(o,e){$(".reply").show(),r&&r.remove(),n=null,r=$(".comment").clone(!0,!0),o?(r.find(".cancel").hide(),r.appendTo(".comment-list")):(o=$(e).parent(),n=o.attr("id"),$(e).after(r)),r.css({display:"flex"})}t(!0),$(".reply").on("click",function(){t(!1,this),$(this).hide()}),$("form.comment .cancel").on("click",function(o){o.preventDefault(),r.remove(),t(!0)}),$("form.comment .send").on("click",function(o){o.preventDefault();o={post:$(".comments").attr("id"),body:r.find("textarea").val(),parent:n};$.ajax({type:"POST",data:JSON.stringify(o),contentType:"application/json",url:"/comment/add"}).done(function(o){var e;console.log(o),o.ok?(e='<ul><li style="background-color:#ffffe0;"><div class="head"><a href="/users/'+o.login+'">'+o.login+'</a><spam class="date">Только что</spam></div>'+o.body+"</li></ul>",$(r).after(e),t(!0)):(void 0===o.error&&(o.error="Неизвестная ошибка!"),$(r).prepend('<p class="error">'+o.error+"</p>"))})})}),$(function(){function e(){$(".post-form p.error").remove(),$(".post-form input, #post-body").removeClass("error")}$(".post-form input, #post-body").on("focus",function(){e()}),$(".publish-button").on("click",function(o){o.preventDefault(),e();o={title:$("#post-title").val(),body:$("#post-body").val()};$.ajax({type:"POST",data:JSON.stringify(o),contentType:"application/json",url:"/post/add"}).done(function(o){console.log(o),o.ok?$(location).attr("href","/"):($(".post-form h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("#post-"+o).addClass("error")}))})}),$("#fileinfo").on("submit",function(o){o.preventDefault();o=new FormData(this);$.ajax({type:"POST",url:"/upload/image",data:o,processData:!1,contentType:!1,success:function(o){console.log(o)},error:function(o){console.log(o)}})})});